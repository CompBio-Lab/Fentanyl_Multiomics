---
title: "EnrichR.Rmd"
output: html_document
date: "2024-05-22"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# EnrichR: Find enriched pathways using differentially expressed genes 

## Load top table 
```{r}
#Load in the top table from Differential expression analysis 
top <- readRDS(here::here("Data", "top_gex.rds"))
```

## Filtering top table 
```{r}
# filter by comparison 
top_dxs <- top[top$comparison == "drug x sex interaction", ]

# filter by adj p.value 
top_dxs <- top_dxs[top_dxs$adj.P.Val < 0.01, ]

# filter by cell type 
Endo_Flt1_Lrg1_1 <- top_dxs[top_dxs$cell == "Endo_Flt1_Lrg1_1", ]
Ex_C1ql4 <- top_dxs[top_dxs$cell == "Ex_C1ql4_Drd1_3", ]
Ex_Ebf2 <- top_dxs[top_dxs$cell == "Ex_Ebf2_Layn", ]
Ex_Plekhg1 <- top_dxs[top_dxs$cell == "Ex_Plekhg1_Nox4_Kcp_2", ]
Ex_Sim1 <- top_dxs[top_dxs$cell == "Ex_Sim1_Aox3_1", ]
Ex_Tfap2b <- top_dxs[top_dxs$cell == "Ex_Tfap2b_Ccdc172_Calcr", ]
Fibro_Eya2 <- top_dxs[top_dxs$cell == "Fibro_Eya2_Ccdc192_2", ]
Inh_Frm7 <- top_dxs[top_dxs$cell == "Inh_Frm7_Otop1_1", ]
```

## Load enrichR library 
```{r}
library(enrichR)
websiteLive <- getOption("enrichR.live")
if (websiteLive) {
    listEnrichrSites()
    setEnrichrSite("Enrichr") 
}

if (websiteLive) dbs <- listEnrichrDbs()

```

## Running EnrichR Pathway Analysis 

```{r}
#View and select databases 
dbs <- c("Allen_Brain_Atlas_10x_scRNA_2021", "KEGG_2019_Mouse", "RNAseq_Automatic_GEO_Signatures_Mouse_Down", "RNAseq_Automatic_GEO_Signatures_Mouse_Up")

#Run enrichR for each cell type 

enriched_Endo_Flt1_Lrg1_1 <- enrichr(Endo_Flt1_Lrg1_1$gene, dbs)
enriched_Ex_C1ql4 <- enrichr(Ex_C1ql4$gene, dbs)
enriched_Ex_Ebf2 <- enrichr(Ex_Ebf2$gene, dbs)
enriched_Ex_Plekhg1 <- enrichr(Ex_Plekhg1$gene, dbs)
enriched_Ex_Sim1 <- enrichr(Ex_Sim1$gene, dbs)
enriched_Ex_Tfap2b <- enrichr(Ex_Tfap2b$gene, dbs)
enriched_Fibro_Eya2 <- enrichr(Fibro_Eya2$gene, dbs)
enriched_Inh_Frm7 <- enrichr(Inh_Frm7$gene, dbs)

```

## Plot enrichR output 
```{r}
if (websiteLive) {
    plotEnrich(enriched_Ex_C1ql4[[2]], showTerms = 20, numChar = 40, y = "Count", orderBy = "P.value")
}
```



